import{world,system}from"@minecraft/server";const nameMap={"hfrlc:backpack_visual_mid":"Backpack Medium","hfrlc:backpack_visual":"Backpack Small","hfrlc:backpack_visual_big":"Backpack Big"};export function backpacks_names(a){nameMap[a.typeId]&&(a.nameTag=nameMap[a.typeId])}export function backpacks_event(a,e){switch(e){case"wear":handleWearEvent(a);break;case"hfrlc:dead_backpack":world.gameRules.keepInventory||world.isHardcore||a.triggerEvent("active_dismount_backpack");break;case"active_dismount_backpack":handleDismountEvent(a)}}function handleWearEvent(a){if(nameMap[a.typeId])for(const e of world.getPlayers()){if(!e.hasTag("active_backpack_event"))continue;const t={x:a.location.x,y:3,z:a.location.z};a.teleport(t);const c=Math.random().toString(36).slice(2,10),n=`${a.typeId.replace("hfrlc:","")}_${c}_${e.name.replace(/ /g,"_")}`,s={x:t.x+1,y:2,z:t.z+1},o={x:t.x-1,y:4,z:t.z-1};world.structureManager.createFromWorld(`mystructure:${n}`,a.dimension,s,o,{includeBlocks:!1,includeEntities:!0,saveMode:"World"}),e.addTag(n),e.removeTag("active_backpack_event"),a.remove()}}function handleDismountEvent(a){let e=null;for(const a of world.getPlayers())if(a.hasTag("dismount_backpack")){e=a;break}if(e){if(e.hasTag("do_tuto0")||e.getTags().some(a=>a.startsWith("do_tuto")||a.startsWith("active_tuto"))&&!e.hasTag("start_game"))return e.hasTag("backpack_message_sent")||(e.dimension.playSound("note.bass",e.location,{pitch:.5}),e.addTag("backpack_message_sent"),system.runTimeout(()=>{e.isValid()&&e.removeTag("backpack_message_sent")},40)),void e.removeTag("dismount_backpack")}const t=a.getTags().filter(a=>a.startsWith("backpack_visual_"));for(const e of t)a.runCommandAsync(`structure load ${e} ~-1~1~-1`),a.runCommandAsync(`structure delete ${e}`),a.triggerEvent("dismount_backpack"),a.removeTag("dismount_backpack"),a.removeTag(e)}